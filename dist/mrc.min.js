/*! mrc - v0.0.1 - 2016-11-20
* Copyright (c) 2016; Licensed  EUPL-1.1 */
"use strict";function setInfo(){var a=document.getElementById("filterType").value;"cql"==a&&(document.getElementById("filter").placeholder="date = 2134|4113"),"ogc"==a&&(document.getElementById("filter").placeholder="For example: <PropertyIsEqualTo><PropertyName>height_val</PropertyName><Literal>123.0</Literal></PropertyIsEqualTo>"),"fid"==a&&(document.getElementById("filter").placeholder="For example: marousi.Maroussi_4081")}function download(a,b,c){c||(c="application/octet-stream");var d=document.createElement("a"),e=new Blob([a],{type:c});d.href=window.URL.createObjectURL(e),d.download=b,d.click()}var options={epsg:"EPSG:4326",bounds:[23.7767658233643,38.0244979858398,23.779,38.04],units:"degrees",zoom:10},map;gsc.map.create("map",options);var interactions=[new ol.interaction.MouseWheelZoom,new ol.interaction.DragPan];gsc.map.interactions=interactions,map=gsc.map.olMap;var container=$("#popup"),content=$("#popup-content"),closer=$("#popup-closer"),url="http://hub.geosmartcity.eu/geoserver/gsc/ows",layerWFS=new ol.layer.Vector({title:"Buildings-WFS",type:"overlay",combine:!0,visible:!1,source:new ol.source.Vector({format:new ol.format.GeoJSON({defaultDataProjection:ol.proj.get("EPSG:4326")}),url:function(a){return"http://hub.geosmartcity.eu/geoserver/gsc/ows?service=WFS&version=1.1.0&request=GetFeature&typename=marousi&outputFormat=application/json&srsname=EPSG:4326&bbox="+a.join(",")+",EPSG:4326"},strategy:ol.loadingstrategy.bbox,projection:"EPSG:4326"})}),marousi=new ol.layer.Image({title:"Buildings",type:"overlay",combine:!0,visible:!0,source:new ol.source.ImageWMS({ratio:1,url:"http://hub.geosmartcity.eu/geoserver/gsc/wms",params:{FORMAT:"image/png",VERSION:"1.1.1",LAYERS:"gsc:marousi",STYLES:""}})}),basemapLayers=new ol.layer.Group({title:"Base maps",layers:[new ol.layer.Tile({title:"Satellite and labels",type:"base",combine:!0,visible:!1,source:new ol.source.BingMaps({key:"Ahd_32h3fT3C7xFHrqhpKzoixGJGHvOlcvXWy6k2RRYARRsrfu7KDctzDT2ei9xB",imagerySet:"Aerial"})}),new ol.layer.Image({title:"WMS ktimatologio",type:"base",combine:!0,visible:!1,source:new ol.source.ImageWMS({ratio:1,url:"http://gis.ktimanet.gr/wms/wmsopen/wmsserver.aspx",params:{FORMAT:"image/png",VERSION:"1.1.1",LAYERS:"ktimatologio",STYLES:""}})}),new ol.layer.Tile({title:"OSM",type:"base",visible:!0,source:new ol.source.OSM})]});gsc.map.addLayer(basemapLayers);var overlaygroupLayers=new ol.layer.Group({title:"Overlays",layers:[marousi,layerWFS]});gsc.map.addLayer(overlaygroupLayers);var formatGML=new ol.format.GML({featureNS:"featureNS",featureType:"featureType",srsName:"EPSG:4326"});gsc.editFeatures.create(container,content,closer,"#mdl-button",map,url),gsc.editFeatures.addLayer(layerWFS,formatGML),gsc.map.addMousePositionControl("coordinate"),gsc.map.addScaleBarControl("scalebar");var layerSwitcher=new ol.control.LayerSwitcher({tipLabel:"Layer Switcher"});gsc.map.olMap.addControl(layerSwitcher),$("#updateFilterButton").on("click",function(){gsc.map.filterOnAttributes($("#filterType").val(),$("#filter").val())}),$("#resetFilterButton").on("click",function(){gsc.map.resetFilter("cql","")}),$(function(){$("#submit").click(function(a){a.preventDefault();var b=$("#address").val();$.ajax({type:"GET",data:{address:b},crossDomain:"true",url:"http://hub.geosmartcity.eu/MarousiGeocoderServer/geo/RestService/getaddress",success:function(a){console.log("response:"+a),$("#data").html("");var b=[],c=[];$.each(a,function(a,d){var e,f,g;$.each(d,function(a,c){if("geometry"==a){var d=$.parseJSON(c);f=d.coordinates[0],g=d.coordinates[1],b.push([f,g])}"address"==a&&(e=c)}),c.push([[f,g],e])});for(var d=[],e=0;e<c.length;e++){var f=new ol.Feature({geometry:new ol.geom.Point(c[e][0]),address:c[e][1]});d.push(f)}var g=new ol.source.Vector({features:d}),h=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",opacity:.75,src:"http://findicons.com/files/icons/1030/windows_7/32/pin.png"})}),i=new ol.layer.Vector({source:g,style:h});gsc.map.addLayer(i);b[0],b[1],ol.proj.transform([b[0][0],b[0][1]],"EPSG:4326","EPSG:3857")},error:function(a,b,c){alert(" Error in processing! "+b)}})})}),$(function(){$("#login-form-link").click(function(a){$("#login-form").delay(100).fadeIn(100),$("#register-form").fadeOut(100),$("#register-form-link").removeClass("active"),$(this).addClass("active"),a.preventDefault()}),$("#register-form-link").click(function(a){$("#register-form").delay(100).fadeIn(100),$("#login-form").fadeOut(100),$("#login-form-link").removeClass("active"),$(this).addClass("active"),a.preventDefault()}),$("#login-submit").click(function(a){a.preventDefault();var b=$("#login-username").value,c=$("#login-password").value;gsc.user.login(b,c).then(function(a){console.log(a.description)})}),$("#register-form").click(function(a){a.preventDefault();var b=$("#register-email").value,c=$("#register-username").value,d=$("#register-password").value,e=$("#register-confirm-password").value,f=$("#organization").value;gsc.user.register(b,c,d,e,[{organization:f}]).then(function(a){var b=a.id;console.log(a.description),console.log(b)})})}),gsc.download.create(map,layerWFS),$(function(){$("#btnDownload").click(function(){var a,b,c=document.getElementById("slcformat").value;"kml"==c&&(a=gsc.download.kml(),b="application/vnd.google-earth.kml+xml",console.log(a)),"wkt"==c&&(a=gsc.download.wkt(),b="text/plain"),"gpx"==c&&(a=gsc.download.gpx(),b="text/plain"),"json"==c&&(a=gsc.download.json(),b="text/plain"),"gml"==c&&(a=gsc.download.gml(ol.format.GML),b="application/gml+xml"),download(a,"result."+c,b)})});